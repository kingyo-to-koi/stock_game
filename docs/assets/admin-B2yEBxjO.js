import{r as p,q as S,o as $,c as j,d as u,a as z,g as E,j as t,s as x,T as h,e as m,u as I,f as M,h as b,R,b as _}from"./index-DI5tGd7w.js";const y=l=>{if(!l)return"";const d=o=>String(o).padStart(2,"0");return`${l.getFullYear()}-${d(l.getMonth()+1)}-${d(l.getDate())}T${d(l.getHours())}:${d(l.getMinutes())}`},Q=l=>l?new Date(l):null,A=l=>{if(!l)return null;if(typeof l?.toDate=="function")return l.toDate();if(l instanceof Date)return l;if(typeof l=="string"){const d=new Date(l);return isNaN(+d)?null:d}return null};function T(){const l=[{id:"n1",order:1,headline:"",body:"",publishAt:null},{id:"n2",order:2,headline:"",body:"",publishAt:null},{id:"n3",order:3,headline:"",body:"",publishAt:null},{id:"n4",order:4,headline:"",body:"",publishAt:null},{id:"n5",order:5,headline:"",body:"",publishAt:null}],[d,o]=p.useState(l);p.useEffect(()=>{const e=S(j(u,"newsQueue"),$("order","asc")),r=z(e,i=>{const n=[];i.forEach(a=>n.push({id:a.id,...a.data()}));const s=l.map(a=>{const N=n.find(P=>P.id===a.id);return N||a});o(s)});return()=>r()},[]);const v=async e=>{await x(m(u,"newsQueue",e.id),{order:e.order,headline:e.headline,body:e.body,publishAt:e.publishAt?h.fromDate(typeof e.publishAt?.toDate=="function"?e.publishAt.toDate():new Date(e.publishAt)):null,updatedAt:b()},{merge:!0}),alert(`${e.id.toUpperCase()} 저장 완료`)},D=async()=>{await Promise.all(d.map(e=>x(m(u,"newsQueue",e.id),{order:e.order,headline:e.headline,body:e.body,publishAt:e.publishAt?h.fromDate(typeof e.publishAt?.toDate=="function"?e.publishAt.toDate():new Date(e.publishAt)):null,updatedAt:b()},{merge:!0}))),alert("뉴스 5개 일괄 저장 완료")},[g,c]=p.useState([]);p.useEffect(()=>{(async()=>{const e=await E(j(u,"stocks")),r=[];e.forEach(i=>r.push({basePrice:0,id:i.id,...i.data()})),c(r.sort((i,n)=>(i.order??0)-(n.order??0)))})()},[]);const w=async()=>{const e=prompt("문서 ID 입력(영문/숫자):","stock-"+Math.random().toString(36).slice(2,6));e&&(await x(m(u,"stocks",e),{name:"새 종목",description:"설명",sector:"",basePrice:1e3,deltaPct:0,order:(g.at(-1)?.order??0)+1,isPublished:!0,scheduledDelta:null,applyAt:null,updatedAt:b()}),location.reload())},C=async e=>{let r=null;if(e.applyAt){if(typeof e.applyAt?.toDate=="function")r=e.applyAt;else if(e.applyAt instanceof Date)r=h.fromDate(e.applyAt);else if(typeof e.applyAt=="string"){const i=Q(e.applyAt);r=i?h.fromDate(i):null}}await I(m(u,"stocks",e.id),{name:e.name,description:e.description,sector:e.sector??"",basePrice:Number(e.basePrice),deltaPct:Number(e.deltaPct),order:e.order??null,isPublished:e.isPublished??!0,scheduledDelta:e.scheduledDelta??null,applyAt:r,updatedAt:b()}),alert("종목 저장됨")},k=async e=>{confirm("삭제?")&&(await M(m(u,"stocks",e)),location.reload())},f=p.useMemo(()=>{const e=new Date;return d.filter(i=>i.publishAt).map(i=>({...i,d:A(i.publishAt)})).filter(i=>i.d&&e>=i.d).sort((i,n)=>+i.d-+n.d).at(-1)??null},[d]);return t.jsx("div",{className:"min-h-screen newspaper-bg p-6",children:t.jsxs("div",{className:"max-w-4xl mx-auto card-nb p-6",children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"운영자 콘솔"}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"font-semibold",children:"뉴스 예약 (5개 시퀀스)"}),t.jsx("button",{className:"btn-primary",onClick:D,children:"전체 저장"})]}),t.jsx("div",{className:"grid gap-3",children:d.map(e=>{const r=e.publishAt?y(A(e.publishAt)):"";return t.jsxs("div",{className:"card-nb p-3",children:[t.jsxs("div",{className:"text-sm text-zinc-500 mb-1",children:[e.id.toUpperCase()," (순서 ",e.order,")"]}),t.jsx("input",{className:"input mb-2",placeholder:"헤드라인",value:e.headline,onChange:i=>o(n=>n.map(s=>s.id===e.id?{...s,headline:i.target.value}:s))}),t.jsx("textarea",{className:"input mb-2",rows:3,placeholder:"본문",value:e.body,onChange:i=>o(n=>n.map(s=>s.id===e.id?{...s,body:i.target.value}:s))}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-zinc-600",children:"노출 시각 (publishAt)"}),t.jsx("input",{type:"datetime-local",className:"input",value:r,onChange:i=>o(n=>n.map(s=>s.id===e.id?{...s,publishAt:i.target.value===""?null:new Date(i.target.value)}:s))})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{className:"btn-ghost",onClick:()=>v(e),children:"이 슬롯만 저장"})})]})]},e.id)})}),t.jsxs("div",{className:"mt-3 text-sm text-zinc-600",children:["현재 시각 기준 노출 예정:"," ",t.jsx("span",{className:"font-medium",children:f?`${f.id.toUpperCase()} — ${f.headline||"(제목 없음)"}`:"예약된 뉴스가 아직 없습니다."})]})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"font-semibold",children:"종목 관리"}),t.jsx("button",{className:"btn-ghost",onClick:w,children:"+ 종목 추가"})]}),t.jsxs("div",{className:"grid gap-3",children:[g.map((e,r)=>{const i=e.applyAt?.toDate?y(e.applyAt.toDate()):e.applyAt instanceof Date?y(e.applyAt):typeof e.applyAt=="string"?e.applyAt:"";return t.jsxs("div",{className:"card-nb p-3",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[160px_160px_1fr_100px_80px] gap-2",children:[t.jsx("input",{className:"input",placeholder:"종목명",value:e.name,onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,name:n.target.value}:a))}),t.jsx("input",{className:"input",placeholder:"업종 (예: 신약개발, 제네릭)",value:e.sector??"",onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,sector:n.target.value}:a))}),t.jsx("input",{className:"input",placeholder:"설명",value:e.description,onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,description:n.target.value}:a))}),t.jsx("input",{type:"number",className:"input",placeholder:"등락%",value:e.deltaPct,onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,deltaPct:Number(n.target.value)}:a))}),t.jsx("input",{type:"number",className:"input",placeholder:"정렬",value:e.order??r+1,onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,order:Number(n.target.value)}:a))})]}),t.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-[140px_140px_1fr] gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-zinc-600",children:"기준가"}),t.jsx("input",{type:"number",className:"input",value:e.basePrice,onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,basePrice:Number(n.target.value)}:a))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-zinc-600",children:"예약 등락률(%)"}),t.jsx("input",{type:"number",className:"input",placeholder:"예: 12",value:e.scheduledDelta??"",onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,scheduledDelta:n.target.value===""?null:Number(n.target.value)}:a))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-zinc-600",children:"적용 시각"}),t.jsx("input",{type:"datetime-local",className:"input",value:i,onChange:n=>c(s=>s.map(a=>a.id===e.id?{...a,applyAt:n.target.value}:a))})]})]}),t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("button",{className:"btn-primary",onClick:()=>C(e),children:"저장"}),t.jsx("button",{className:"btn-danger",onClick:()=>k(e.id),children:"삭제"})]})]},e.id)}),g.length===0&&t.jsx("div",{className:"text-zinc-500",children:"종목 없음"})]})]})})}R.createRoot(document.getElementById("root")).render(t.jsx(_.StrictMode,{children:t.jsx(T,{})}));
